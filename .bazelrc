common --experimental_enable_bzlmod
build  --experimental_remote_downloader_local_fallback

build --incompatible_strict_action_env
build --shell_executable=/bin/bash

build --action_env=STORAGE_PG_BACKEND_USER
build --action_env=STORAGE_PG_BACKEND_HOST
build --action_env=STORAGE_PG_BACKEND_PASSWORD
build --action_env=STORAGE_PG_BACKEND_JDBC_URL

build --java_language_version=17
build --java_runtime_version=remotejdk_17
build --tool_java_language_version=17
build --tool_java_runtime_version=remotejdk_17

build --incompatible_default_to_explicit_init_py
test --incompatible_default_to_explicit_init_py

# TODO remove this when grpc-java can be built without
build --javacopt="-XepDisableAllChecks"

build --sandbox_default_allow_network=false
build --action_env=CC=/usr/lib/llvm/18/bin/clang
build --action_env=CXX=/usr/lib/llvm/18/bin/clang++
build --repo_env=CC=/usr/lib/llvm/18/bin/clang
build --repo_env=CXX=/usr/lib/llvm/18/bin/clang++
run --incompatible_strict_action_env

common --incompatible_allow_tags_propagation

# rules_ts
build --@aspect_rules_ts//ts:skipLibCheck=honor_tsconfig
fetch --@aspect_rules_ts//ts:skipLibCheck=honor_tsconfig
query --@aspect_rules_ts//ts:skipLibCheck=honor_tsconfig

# pulls vars set in .bazelrc.local by logos dev setup
run --run_under='//tools:bazel-env'

try-import %workspace%/.bazelrc.local
try-import %workspace%/.apko/.bazelrc
